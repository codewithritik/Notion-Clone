---
description: 
globs: 
alwaysApply: true
---
# ğŸ§­ User Flow Document â€” Notion + Obsidian.md (AI-Enhanced)

**Version:** MVP / Phase 1  
**Target:** Coding agents, frontend/backend engineers, product designers  
**Platform:** Web app (fully responsive)

## ğŸ‘¤ 1. Authentication Flow

### 1.1 Sign Up
```sql
[User clicks "Sign Up"]
    â†’ Enters email and password
    â†’ Clicks "Create Account"
        â†’ POST /api/auth/signup
            â†’ On success:
                â†’ Redirect to Create/Join Workspace screen
```

### 1.2 Log In
```sql
[User clicks "Log In"]
    â†’ Enters email and password
    â†’ Clicks "Log In"
        â†’ POST /api/auth/login
            â†’ On success:
                â†’ Redirect to default workspace & last opened page
```

## ğŸ¢ 2. Workspace Flow

### 2.1 Create Workspace
```pgsql
[User clicks "Create Workspace"]
    â†’ Enters name
    â†’ Clicks "Create"
        â†’ POST /api/workspaces
            â†’ Automatically becomes Owner
            â†’ Redirect to /workspace/:workspaceId
```

### 2.2 Join Existing Workspace (invite-based, Phase 2)
Not implemented in Phase 1 â€” skip for now.

## ğŸ“„ 3. Page Management Flow

### 3.1 Create Page
```pgsql
[User clicks "+ New Page" in sidebar]
    â†’ Prompt for page title
    â†’ Optionally select from template
        â†’ POST /api/pages
            â†’ Append page to workspace page tree
            â†’ Redirect to TipTap editor
```

### 3.2 View Page
```sql
[User clicks a page in the sidebar or navigates via URL slug]
    â†’ GET /api/pages/:pageId
    â†’ Render TipTap editor with content
```

### 3.3 Edit Page
```bash
[User types in editor]
    â†’ Frontend debounces and triggers PATCH /api/pages/:pageId
    â†’ Autosave version â†’ POST /api/versions
    â†’ WebSocket sync cursor presence â†’ /ws/cursors/:pageId
```

### 3.4 Page Tree Navigation
```sql
[User opens sidebar]
    â†’ GET /api/pages/tree
        â†’ Displays hierarchy with parent-child nesting
        â†’ Supports drag-and-drop (calls PATCH /api/pages/:pageId with new parent)
```

## ğŸ§  4. Templates Flow

### 4.1 Use Template
```pgsql
[User clicks "+ New Page"]
    â†’ Selects "Template"
        â†’ GET /api/templates
        â†’ Preview options: Meeting Notes, Wiki, Project Spec
        â†’ Uses selected template as base content
```

## ğŸ” 5. Version History Flow

### 5.1 Auto-Save Version (on edit)
```sql
[User edits content]
    â†’ Triggers POST /api/versions (latest only, overwrites)
```

### 5.2 View Last Version
```pgsql
[User clicks "View History"]
    â†’ GET /api/versions/:pageId/latest
        â†’ Render read-only preview of last version
```

## ğŸ“¡ 6. WebSocket Sync Flow (Cursor Presence)

### 6.1 Open Editor
```pgsql
â†’ Connects to WebSocket: /ws/cursors/:pageId
    â†’ Sends cursor presence updates
    â†’ Receives presence of others (if any)
    â†’ Only one user is allowed to edit simultaneously
```

## ğŸ§‘â€ğŸ¤â€ğŸ§‘ 7. Members & Permissions

### 7.1 View Workspace Members
```ruby
â†’ GET /api/workspaces/:workspaceId/members
â†’ Shows role: Owner, Editor, Viewer
```
**Note:** No invitation, no role editing in Phase 1.

## ğŸ” 8. Search & Navigation

### 8.1 Search Pages (Phase 2)
Not in Phase 1. Use page tree for navigation.

## ğŸ§¬ 9. Silent Embedding Collection (AI Prep)

### 9.1 On Page Create/Edit
```css
â†’ Backend triggers silent embedding collection for content
â†’ Prepares vector DB (Qdrant) for future AI linking, search, and Q&A
```

## ğŸ–¼ï¸ 10. UI Structure Navigation
```pgsql
+-----------------------------+
| Sidebar (collapsible)      |
| - Pages                    |
| - Templates                |
+-----------------------------+
| Top Bar                    |
| - Breadcrumbs              |
| - Workspace Title          |
| - Search                   |
+-----------------------------+
| Editor (TipTap)            |
| - Markdown + Drag blocks   |
| - Tables, code blocks      |
+-----------------------------+
```

## ğŸ“± 11. Responsiveness Flow
```pgsql
[User opens on mobile]
    â†’ Sidebar collapses into hamburger
    â†’ Editor becomes single-column
    â†’ Buttons adapt (fixed bottom if needed)
```

## âœ… 12. Summary Flowchart
```pgsql
[Sign Up / Log In]
       â†“
[Create Workspace]
       â†“
[New Page / Use Template]
       â†“
[Edit with TipTap]
       â†“
[Auto-save version, sync cursor]
       â†“
[View last version / see presence]
       â†“
[Silent AI embedding triggers]
```